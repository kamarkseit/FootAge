<!DOCTYPE html>
<html>

<head>
    <title>FootAge Recorder</title>
    <link rel="icon" type="image/x-icon" href="favicon.ico">
</head>

<body>
    <h1>Record Your Walk</h1>
    <video id="preview" autoplay muted></video>
    <br>
    <button id="startBtn">Start Recording</button>
    <button id="stopBtn" disabled>Stop Recording</button>

    <script>
        let mediaRecorder;
        let recordedChunks = [];

        const startBtn = document.getElementById('startBtn');
        const stopBtn = document.getElementById('stopBtn');
        const preview = document.getElementById('preview');

        startBtn.onclick = async () => {
            recordedChunks = [];
            const stream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });
            preview.srcObject = stream;

            mediaRecorder = new MediaRecorder(stream);
            mediaRecorder.ondataavailable = e => recordedChunks.push(e.data);
            mediaRecorder.onstop = async () => {
                const blob = new Blob(recordedChunks, { type: 'video/webm' });
                const formData = new FormData();
                formData.append('video', blob, 'walk_video.webm');

                // ✅ This is where your fetch() call goes
                fetch('https://footage-backend.onrender.com/upload', {
                    method: 'POST',
                    body: formData
                })
                    .then(response => response.text())
                    .then(data => alert('✅ Video uploaded and processed'))
                    .catch(error => alert('❌ Upload failed: ' + error));
            };

            mediaRecorder.start();
            stopBtn.disabled = false;
            startBtn.disabled = true;

            setTimeout(() => {
                if (mediaRecorder.state === 'recording') mediaRecorder.stop();
            }, 30000);
        };

        stopBtn.onclick = () => {
            if (mediaRecorder.state === 'recording') mediaRecorder.stop();
            stopBtn.disabled = true;
            startBtn.disabled = false;
        };
    </script>
</body>

</html>